<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Live Code Music Gen</title>
  <link rel="stylesheet" href="./style.css" />
  <link rel="stylesheet" href="./suggestions.css" />
</head>

<body>
  <div id="app">
    <div id="control-bar">
      <button id="play-stop-btn" class="control-btn" aria-label="Play or stop audio">PLAY ‚ñ∂Ô∏è</button>

      <div class="control-group">
        <label for="bpm-input">BPM:</label>
        <input type="number" id="bpm-input" value="135" inputmode="numeric" aria-label="Tempo BPM">
      </div>

      <div class="control-group">
        <label for="preset-select">Preset:</label>
        <select id="preset-select" aria-label="Select a preset">
          <option value="custom" selected>Custom</option>
          <option value="techno">Techno</option>
          <option value="house">House</option>
          <option value="ambient">Ambient</option>
        </select>
      </div>

      <div class="control-group">
        <label for="master-volume">Vol:</label>
        <input id="master-volume" type="range" min="0" max="1" step="0.01" value="0.9" aria-label="Master volume">
        <span class="val" id="val-master-volume">0.9</span>
      </div>

      <div class="control-group">
        <label for="master-reverb">Rev:</label>
        <input id="master-reverb" type="range" min="0" max="1" step="0.01" value="0.15" aria-label="Master reverb amount">
        <span class="val" id="val-master-reverb">0.15</span>
      </div>

      <div class="control-group" title="Simulate USB-1601 signal (Offline Mode)">
        <label for="sim-slider" style="color:#aaa">Sim:</label>
        <input id="sim-slider" type="range" min="0" max="1" step="0.01" value="0" aria-label="Simulate USB Signal">
        <span class="val" id="val-sim-slider">0.0</span>
      </div>

      <button id="save-btn" class="control-btn secondary" aria-label="Export settings">EXPORT</button>
      <button id="load-btn" class="control-btn secondary" aria-label="Import settings">IMPORT</button>
      <input id="load-file" type="file" accept="application/json" hidden>

      <button id="fullscreen-btn" class="control-btn secondary" aria-label="Toggle fullscreen">FULLSCREEN ‚õ∂</button>
      <button id="help-btn" class="control-btn secondary" aria-label="Open guide">SOURCE & GUIDE ‚ùì</button>

      <div id="status" role="status" aria-live="polite"></div>
    </div>

    <div class="code-container">
      <!-- Melody / Acid Line -->
      <div class="code-block">
        <div class="code-header" aria-hidden="true">
          <span class="code-title">ACID</span>
          <span class="code-subtitle">16th notes ‚Ä¢ live editable</span>
        </div>
        <span class="prompt">$:</span> <span class="func">n</span>("<span class="str editable" id="acid-pattern"
          contenteditable="true" spellcheck="false" tabindex="0" aria-label="Acid pattern">0 2 4 7 9 7 4 2 0 2 5 9 12 9 5 2</span>")
        <br>&nbsp;&nbsp;.<span class="func">scale</span>("<span class="str editable" id="acid-scale"
          contenteditable="true" spellcheck="false" tabindex="0" aria-label="Acid scale">a:minor</span>")
        <br>&nbsp;&nbsp;.<span class="func">trans</span>(<span class="val editable" id="acid-trans"
          contenteditable="true" tabindex="0" aria-label="Acid transpose">-12</span>)
        <br>&nbsp;&nbsp;.<span class="func">s</span>("<span class="str editable" id="acid-synth-type"
          contenteditable="true" tabindex="0" aria-label="Acid oscillator type">sawtooth</span>")
        <br>&nbsp;&nbsp;.<span class="func">acidenv</span>(<span class="slider-container"><input type="range"
          id="acid-cutoff" min="0" max="1" step="0.01" value="0.4" aria-label="Acid envelope cutoff"> <span class="val"
            id="val-acid-cutoff">0.4</span></span>)
        <br>&nbsp;&nbsp;.<span class="func">lpf</span>(<span class="slider-container"><input type="range" id="acid-lpf"
          min="200" max="12000" step="10" value="2500" aria-label="Acid low-pass filter frequency"> <span class="val" id="val-acid-lpf">2500</span></span>)
        <br>&nbsp;&nbsp;.<span class="func">delay</span>(<span class="slider-container"><input type="range"
          id="acid-delay" min="0" max="1" step="0.01" value="0.4" aria-label="Acid delay amount"> <span class="val"
            id="val-acid-delay">0.4</span></span>)
        <br>&nbsp;&nbsp;.<span class="func">gain</span>(<span class="slider-container"><input type="range"
          id="acid-gain" min="0" max="1" step="0.01" value="0.6" aria-label="Acid gain"> <span class="val"
            id="val-acid-gain">0.6</span></span>)
      </div>

      <br>

      <!-- Bass Line -->
      <div class="code-block">
        <div class="code-header" aria-hidden="true">
          <span class="code-title">BASS</span>
          <span class="code-subtitle">quarter notes ‚Ä¢ live editable</span>
        </div>
        <span class="prompt">$:</span> <span class="func">n</span>("<span class="str editable" id="bass-pattern"
          contenteditable="true" spellcheck="false" tabindex="0" aria-label="Bass pattern">0 0 0 -3</span>")
        <br>&nbsp;&nbsp;.<span class="func">scale</span>("<span class="str editable" id="bass-scale"
          contenteditable="true" spellcheck="false" tabindex="0" aria-label="Bass scale">a:minor</span>")
        <br>&nbsp;&nbsp;.<span class="func">trans</span>(<span class="val editable" id="bass-trans"
          contenteditable="true" tabindex="0" aria-label="Bass transpose">-24</span>)
        <br>&nbsp;&nbsp;.<span class="func">s</span>("<span class="str editable" id="bass-synth-type"
          contenteditable="true" tabindex="0" aria-label="Bass oscillator type">square</span>")
        <br>&nbsp;&nbsp;.<span class="func">lpf</span>(260)
        <br>&nbsp;&nbsp;.<span class="func">duck</span>(<span class="slider-container"><input type="range"
          id="bass-duck" min="0" max="1" step="0.01" value="0.4" aria-label="Bass ducking amount"> <span class="val"
            id="val-bass-duck">0.4</span></span>)
        <br>&nbsp;&nbsp;.<span class="func">gain</span>(0.95)
      </div>

      <br>

      <!-- Drums -->
      <div class="code-block">
        <div class="code-header" aria-hidden="true">
          <span class="code-title">DRUMS</span>
          <span class="code-subtitle">16-step patterns</span>
        </div>

        <span class="prompt">$:</span> <span class="func">s</span>("<span class="str">bd:</span><span class="str editable" id="kick-pattern"
          contenteditable="true" spellcheck="false" tabindex="0" aria-label="Kick 16-step pattern">x---x---x---x---</span><span class="str">"</span>)
        <br>&nbsp;&nbsp;.<span class="func">shape</span>(<span class="slider-container"><input type="range"
          id="kick-shape" min="0" max="1" step="0.01" value="0.2" aria-label="Kick distortion amount"> <span class="val"
            id="val-kick-shape">0.2</span></span>)
        <br>&nbsp;&nbsp;.<span class="func">lpf</span>(<span class="slider-container"><input type="range" id="kick-lpf"
          min="200" max="12000" step="100" value="3000" aria-label="Kick low-pass filter frequency"> <span class="val" id="val-kick-lpf">3000</span></span>)
        <br>&nbsp;&nbsp;.<span class="func">gain</span>(<span class="slider-container"><input type="range"
          id="kick-gain" min="0" max="1.5" step="0.01" value="1.0" aria-label="Kick gain"> <span class="val"
            id="val-kick-gain">1.0</span></span>)

        <br>
        <span class="prompt">$:</span> <span class="func">s</span>("<span class="str">hh:</span><span class="str editable" id="hat-pattern"
          contenteditable="true" spellcheck="false" tabindex="0" aria-label="Hat 16-step pattern">x-x-x-x-x-x-x-x-</span><span class="str">"</span>)
        <br>&nbsp;&nbsp;.<span class="func">gain</span>(<span class="val editable" id="hat-gain" contenteditable="true" tabindex="0" aria-label="Hat gain">0.15</span>)

        <br>
        <span class="prompt">$:</span> <span class="func">s</span>("<span class="str">sn:</span><span class="str editable" id="snare-pattern"
          contenteditable="true" spellcheck="false" tabindex="0" aria-label="Snare 16-step pattern">----x-------x---</span><span class="str">"</span>)
        <br>&nbsp;&nbsp;.<span class="func">gain</span>(<span class="val editable" id="snare-gain" contenteditable="true" tabindex="0" aria-label="Snare gain">0.22</span>)
      </div>
    </div>

    <!-- Visualizer Dock (fixed bottom panel) -->
    <div id="visualizer-dock" aria-hidden="true">
      <div id="dock-label">SPECTRUM ‚Ä¢ WAVE ‚Ä¢ NOTES</div>
      <canvas id="visualizer"></canvas>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="modal hidden">
      <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>üéπ Live Code Music ‚Äî Source & Guide (Drag Me!)</h2>
        <p>Edit the highlighted values. Changes apply live (and are auto-saved).</p>

        <h3>üöÄ Demo Flow (2 minutes)</h3>
        <ul>
          <li>Pick a <strong>Preset</strong> ‚Üí press <strong>PLAY</strong>.</li>
          <li>Change <strong>BPM</strong> (e.g. 110 ‚Üí 150) to show tempo control.</li>
          <li>Edit <strong>ACID n("...")</strong> (try <code>0 2 4 7 9 7 4 2</code>).</li>
          <li>Edit <strong>scale("...")</strong> (try <code>c:major</code>, <code>d:dorian</code>).</li>
          <li>Edit <strong>DRUMS bd/hh/sn</strong> patterns to show groove changes.</li>
          <li>Press <strong>FULLSCREEN</strong> for stage/demo mode.</li>
          <li>Use <strong>EXPORT</strong> to capture your best take.</li>
        </ul>

        <h3>‚å®Ô∏è Shortcuts</h3>
        <ul>
          <li><strong>Space</strong>: Play / Stop (when not typing in a field)</li>
          <li><strong>H</strong> or <strong>?</strong>: Toggle this guide</li>
          <li><strong>Esc</strong>: Exit fullscreen</li>
        </ul>

        <h3>üìù Editing Rules</h3>
        <ul>
          <li><strong>n("...")</strong>: Space-separated degrees. <code>0</code> = root, <code>2</code> = 3rd, <code>4</code> = 5th. Negative values go down.</li>
          <li><strong>scale("...")</strong>: Choose a scale name like <code>a:minor</code>, <code>c:major</code>, <code>d:dorian</code>, <code>chromatic</code>.</li>
          <li><strong>trans(...)</strong>: Semitone transpose. Typical: Acid <code>-12</code>, Bass <code>-24</code>.</li>
          <li><strong>s("...")</strong> synth type: <code>sawtooth</code>, <code>square</code>, <code>sine</code>, <code>triangle</code> (bass also supports <code>fmsine</code>).</li>
          <li><strong>DRUMS patterns</strong>: 16 characters per bar. Use <code>x</code> = hit, <code>-</code> = rest. Example: <code>x---x---x---x---</code>.</li>
        </ul>

        <h3>üéõÔ∏è Sliders</h3>
        <ul>
          <li><strong>acidenv / cutoff</strong>: "Brightness" of the sound. Open it up for energy!</li>
          <li><strong>lpf</strong>: Low Pass Filter. Removes high frequencies (muffles the sound).</li>
          <li><strong>duck</strong>: Sidechain compression. Makes the bass "pump" with the kick.</li>
          <li><strong>delay</strong>: Echo effect.</li>
          <li><strong>shape</strong>: Distortion/Saturation. Makes the kick drum harder/grittier.</li>
        </ul>

        <h3>üíæ Saving</h3>
        <ul>
          <li>Edits are auto-saved to your browser.</li>
          <li><strong>EXPORT</strong> downloads a JSON snapshot.</li>
          <li><strong>IMPORT</strong> restores a snapshot.</li>
        </ul>

        <p><em>Tip: Stop, edit, then play again for clean takes.</em></p>
      </div>
    </div>
  </div>
  <script type="module" src="/main.js"></script>
</body>

</html>